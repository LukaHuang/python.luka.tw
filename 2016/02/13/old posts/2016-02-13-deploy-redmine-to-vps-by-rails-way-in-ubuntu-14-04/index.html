<!DOCTYPE html><html class="appearance-light" lang="en"><head><meta charset="UTF-8"><title>Deploy Redmine to VPS by Rails way in Ubuntu 14.04</title><meta name="description"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/widget-post-list.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="前言Redmine 是一套以 Ruby 為基底的專案管理網頁應用程式。而且正好就是使用 Ruby on Rails 開發的。所以如果你是 Rails 工程師，使用一般部屬 Rails 專案的方式就可將 Redmine 架起來。
本文記錄下來的方法，是我覺得最簡單，並且沒有副作用的架設方法。如果你要架設的不是 Redmine ，而是其他的 Rails 專案，也同樣適用。
本文採用的環境：OS: Ubuntu 14.04VPS: Digital Ocean
在 Ubuntu 創造新的使用者Linux 是非常嚴謹的系統，不同資料夾放的東西都有其規範。而 root 帳號在 Linux 系統中是超人，可以做任何的事情。為了維持 Linux 系統的乾淨度，我們要建立一個專用的使用者 oceanttd 而不是直接使用 r.."><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Luka.tw</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Deploy Redmine to VPS by Rails way in Ubuntu 14.04</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><div class="post-container" style="position: sticky; top: 50px;"><main class="aside-card-container categories-widget category-page"><h3 style="font-size:1em;">Categories</h3><section><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/01-Python-%E5%9F%BA%E7%A4%8E%E6%95%99%E5%AD%B8/">01 Python 基礎教學</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/02-Python-%E7%88%AC%E8%9F%B2%E6%95%99%E5%AD%B8/">02 Python 爬蟲教學</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/03-Python-Flask-%E6%95%99%E5%AD%B8/">03 Python Flask 教學</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/04-Python-Django-%E6%95%99%E5%AD%B8/">04 Python Django 教學</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/05-Python-%E8%B3%87%E6%96%99%E5%BA%AB%E6%95%99%E5%AD%B8/">05 Python 資料庫教學</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/06-Python-%E8%B3%87%E6%96%99%E5%88%86%E6%9E%90/">06 Python 資料分析</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/07-Python-%E6%A9%9F%E5%99%A8%E5%AD%B8%E7%BF%92/">07 Python 機器學習</a><span class="category-list-count">1</span></li></ul></section></main><div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8-Ubuntu-%E5%89%B5%E9%80%A0%E6%96%B0%E7%9A%84%E4%BD%BF%E7%94%A8%E8%80%85"><span class="toc-text">在 Ubuntu 創造新的使用者</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0-Ubuntu-apt-get-%E7%9A%84%E5%A5%97%E4%BB%B6"><span class="toc-text">更新 Ubuntu apt-get 的套件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%9D-Mysql-%E6%88%96%E6%98%AF%E5%85%B6%E4%BB%96%E8%B3%87%E6%96%99%E5%BA%AB"><span class="toc-text">安裝 Mysql 或是其他資料庫</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%9D-RVM"><span class="toc-text">安裝 RVM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8-RVM-%E4%B8%AD%E5%AE%89%E8%A3%9D-Ruby"><span class="toc-text">在 RVM 中安裝 Ruby</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%9D-Rails"><span class="toc-text">安裝 Rails</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%8A-Redmine-%E5%B0%88%E6%A1%88%E8%BC%89%E4%B8%8B%E4%BE%86%EF%BC%8C"><span class="toc-text">把 Redmine 專案載下來，</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8D-Rails-%E5%B0%88%E6%A1%88%E7%9A%84%E4%B8%80%E4%BA%9B%E8%99%95%E7%90%86"><span class="toc-text">對 Rails 專案的一些處理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Rails-%E8%B3%87%E6%96%99%E5%BA%AB%E8%99%95%E7%90%86"><span class="toc-text">Rails 資料庫處理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%9D-Passenger"><span class="toc-text">安裝 Passenger</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Passenger-%E5%AE%89%E8%A3%9D-nginx"><span class="toc-text">使用 Passenger 安裝 nginx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Nginx-init-script"><span class="toc-text">安装 Nginx init script</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A8%AD%E5%AE%9A-nginx-conf"><span class="toc-text">設定 nginx.conf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%B0-Rails-project-%E4%B8%8B%E9%87%8D%E5%95%9F-nginx"><span class="toc-text">到 Rails project 下重啟 nginx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E9%81%8E%E7%A8%8B%E4%B8%AD%E5%8F%AF%E8%83%BD%E9%81%87%E5%88%B0%E7%9A%84%E9%8C%AF%E8%AA%A4"><span class="toc-text">在過程中可能遇到的錯誤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Incomplete-response-received-from-application"><span class="toc-text">Incomplete response received from application</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%83%E8%80%83%E9%80%A3%E7%B5%90"><span class="toc-text">參考連結</span></a></li></ol></div></div></div><div class="column is-9"><header class="my-4"><a href="/tags/Rails"><i class="tag post-item-tag">Rails</i></a><a href="/tags/Redmine"><i class="tag post-item-tag">Redmine</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">Deploy Redmine to VPS by Rails way in Ubuntu 14.04</h1><time class="has-text-grey" datetime="2016-02-13T02:30:00.000Z">2016-02-13</time><article class="mt-2 post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Redmine 是一套以 Ruby 為基底的專案管理網頁應用程式。而且正好就是使用 Ruby on Rails 開發的。所以如果你是 Rails 工程師，使用一般部屬 Rails 專案的方式就可將 Redmine 架起來。</p>
<p>本文記錄下來的方法，是我覺得最簡單，並且沒有副作用的架設方法。如果你要架設的不是 Redmine ，而是其他的 Rails 專案，也同樣適用。</p>
<p>本文採用的環境：<br>OS: Ubuntu 14.04<br>VPS: Digital Ocean</p>
<h2 id="在-Ubuntu-創造新的使用者"><a href="#在-Ubuntu-創造新的使用者" class="headerlink" title="在 Ubuntu 創造新的使用者"></a>在 Ubuntu 創造新的使用者</h2><p>Linux 是非常嚴謹的系統，不同資料夾放的東西都有其規範。而 root 帳號在 Linux 系統中是超人，可以做任何的事情。為了維持 Linux 系統的乾淨度，我們要建立一個專用的使用者 oceanttd 而不是直接使用 root 帳號來部屬。這樣在有多人要同時使用同一個 Linux 作業系統的時候會減少很多麻煩。</p>
<p>創造部屬的帳號 <code>oceanttd</code></p>
<pre><code>sudo adduser oceanttd
</code></pre>
<p>把 oceanttd 帳號加到 sudo 群組<a target="_blank" rel="noopener" href="http://askubuntu.com/questions/7477/how-can-i-add-a-new-user-as-sudoer-using-the-command-line">(?)</a></p>
<pre><code>sudo adduser oceanttd sudo
</code></pre>
<p>切換到 oceanttd 帳號</p>
<pre><code>su oceanttd
</code></pre>
<h2 id="更新-Ubuntu-apt-get-的套件"><a href="#更新-Ubuntu-apt-get-的套件" class="headerlink" title="更新 Ubuntu apt-get 的套件"></a>更新 Ubuntu apt-get 的套件</h2><pre><code>sudo apt-get update
</code></pre>
<h2 id="安裝-Mysql-或是其他資料庫"><a href="#安裝-Mysql-或是其他資料庫" class="headerlink" title="安裝 Mysql 或是其他資料庫"></a>安裝 Mysql 或是其他資料庫</h2><pre><code>sudo apt-get install mysql-server
</code></pre>
<h2 id="安裝-RVM"><a href="#安裝-RVM" class="headerlink" title="安裝 RVM"></a>安裝 RVM</h2><p>輸入指令安裝 RVM，過程中可能會出現一些錯誤訊息，因為我沒有預先使用 <code>apt-get</code> 安裝需要的套件。不過不要緊，跟著系統會告訴哪些還沒裝好，並且會給你安裝的指令，跟著系統指示很快的就可以完成。</p>
<pre><code>curl -L https://get.rvm.io | bash
</code></pre>
<p>重新登入 vps，輸入 <code>rvm -v</code> 查看 rvm 是否有裝好。</p>
<h2 id="在-RVM-中安裝-Ruby"><a href="#在-RVM-中安裝-Ruby" class="headerlink" title="在 RVM 中安裝 Ruby"></a>在 RVM 中安裝 Ruby</h2><pre><code>rvm install 2.2.3
</code></pre>
<p>將 ruby 2.2.3 設定成預設的 Ruby 語言，這個動作很重要一定要做，因為預設的 Ruby 會是 Ubuntu 系統中預裝的版本，換成 RVM 的版本我們才好處理 Gem 之類的安裝問題</p>
<pre><code>rvm use 2.2.3 --default
</code></pre>
<p>檢查系統中的 ruby 是否使用 rvm 的 ruby</p>
<p>輸入<code>ruby -v</code>檢查版本<br>輸入<code>which ruby</code> 檢查路徑，路徑裡面有 rvm 的才是正確</p>
<h2 id="安裝-Rails"><a href="#安裝-Rails" class="headerlink" title="安裝 Rails"></a>安裝 Rails</h2><p>記得加上 <code>--no-ri --no-rdoc</code> ，意思是不要裝文件，因為我們上網查就好了。可以省下很多時間。</p>
<pre><code>gem install rails --no-ri --no-rdoc
</code></pre>
<h2 id="把-Redmine-專案載下來，"><a href="#把-Redmine-專案載下來，" class="headerlink" title="把 Redmine 專案載下來，"></a>把 Redmine 專案載下來，</h2><p>( 如果你要部屬的是自己的專案，請 git clone 你自己的專案 )</p>
<p>到 Redmine 官方的<a target="_blank" rel="noopener" href="http://www.redmine.org/projects/redmine/wiki/Download">下載頁面</a>下載最新版本或是你想要的版本的 Redmine。我的版本是 3.2.0 有支援 markown。就以 3.2.0 為例好了，如果你想要用別的版本可以自行替換。</p>
<pre><code>wget http://www.redmine.org/releases/redmine-3.2.0.tar.gz
</code></pre>
<p>解壓縮</p>
<pre><code>tar xzf redmine-3.2.0.tar.gz
</code></pre>
<p>現在你有一個 Redmine 的 Rails 專案了。</p>
<h2 id="對-Rails-專案的一些處理"><a href="#對-Rails-專案的一些處理" class="headerlink" title="對 Rails 專案的一些處理"></a>對 Rails 專案的一些處理</h2><p>bundle 一下。可能會有一些 Ubuntu 的套件沒有裝會噴錯誤。不過都還滿簡單的。</p>
<pre><code>bundle
</code></pre>
<p>缺少 imagemagick 的話可以下下面指令。</p>
<pre><code>$ sudo apt-get install imagemagick
$ sudo apt-get install libmagickwand-dev
</code></pre>
<h3 id="Rails-資料庫處理"><a href="#Rails-資料庫處理" class="headerlink" title="Rails 資料庫處理"></a>Rails 資料庫處理</h3><pre><code>rake db:create
rake db:migrate
</code></pre>
<p>建之前要更新一下 <code>config/database.yml</code> 的內容，把 VPS Server 上的 mysql 帳號密碼寫進去。</p>
<h2 id="安裝-Passenger"><a href="#安裝-Passenger" class="headerlink" title="安裝 Passenger"></a>安裝 Passenger</h2><pre><code>gem install passenger --no-ri --no-rdoc
</code></pre>
<h2 id="使用-Passenger-安裝-nginx"><a href="#使用-Passenger-安裝-nginx" class="headerlink" title="使用 Passenger 安裝 nginx"></a>使用 Passenger 安裝 nginx</h2><pre><code>rvmsudo passenger-install-nginx-module
</code></pre>
<h2 id="安装-Nginx-init-script"><a href="#安装-Nginx-init-script" class="headerlink" title="安装 Nginx init script"></a>安装 Nginx init script</h2><pre><code>$ cd ~/
$ git clone git://github.com/jnstq/rails-nginx-passenger-ubuntu.git
$ sudo mv rails-nginx-passenger-ubuntu/nginx/nginx /etc/init.d/nginx
$ sudo chmod +x /etc/init.d/nginx
</code></pre>
<p>開機自動啟動</p>
<pre><code>$ sudo update-rc.d nginx defaults
</code></pre>
<p>(內容來自 ruby china 文尾有連結)</p>
<h2 id="設定-nginx-conf"><a href="#設定-nginx-conf" class="headerlink" title="設定 nginx.conf"></a>設定 nginx.conf</h2><p>打開 nginx.conf</p>
<pre><code>sudo vim /opt/nginx/conf/nginx.conf
</code></pre>
<pre><code class="conf">user jason; # 修改成你的系统帐号名，不然项目目录 /home/jason/www 这里没有权限
worker_processes 8; # 修改成和你 CPU 核数一样
pid /var/run/nginx.pid;

http &#123;
  include       mime.types;
  default_type  application/octet-stream;

  client_max_body_size 50m;

  sendfile        on;

  access_log /var/log/nginx/access.log;
  error_log /var/log/nginx/error.log;

  gzip on;
  gzip_disable &quot;msie6&quot;;

  ## ------------ 重点修改内容 --------

  server &#123;
    # 此处用于防止其他的域名绑定到你的网站上面
    listen 80 default;
    return 403;
  &#125;

  server &#123;
    listen       80;
    server_name  you.host.name; # 请替换成你网站的域名
    rails_env    production;
    root         /home/jason/www/gitlab/public;
    passenger_enabled on;

    location ~ ^(/assets) &#123;
      access_log        off;
      # 设置 assets 下面的浏览器缓存时间为最大值（由于 Rails Assets Pipline 的文件名是根据文件修改产生的 MD5 digest 文件名，所以此处可以放心开启）
      expires           max;
    &#125;
  &#125;

  ## ---------------------------------
&#125;
</code></pre>
<p>重新啟動 Nginx</p>
<pre><code>sudo /etc/init.d/nginx start
</code></pre>
<h2 id="到-Rails-project-下重啟-nginx"><a href="#到-Rails-project-下重啟-nginx" class="headerlink" title="到 Rails project 下重啟 nginx"></a>到 Rails project 下重啟 nginx</h2><pre><code>touch tmp/restart.txt
</code></pre>
<p>大功告成，現在你應該可以透過你的 server ip，連接到你架設的 Redmine 上了^^</p>
<h2 id="在過程中可能遇到的錯誤"><a href="#在過程中可能遇到的錯誤" class="headerlink" title="在過程中可能遇到的錯誤"></a>在過程中可能遇到的錯誤</h2><h3 id="Incomplete-response-received-from-application"><a href="#Incomplete-response-received-from-application" class="headerlink" title="Incomplete response received from application"></a>Incomplete response received from application</h3><p>打開瀏覽器看到 <code>Incomplete response received from application</code> 時。這時候我們可以去看看<code>/opt/nginx/logs/error.log</code>。發現有以下訊息：</p>
<pre><code>*** Exception RuntimeError in Rack application object (Missing `secret_token` and `secret_key_base` for &#39;production&#39; environment, set these values in `config/secrets.yml`) (process 5076, thread 0x007fd841f79d58(Worker 1)):
</code></pre>
<p>這時候我們在 secret.yml 中加入 secret_token 即可。</p>
<h2 id="參考連結"><a href="#參考連結" class="headerlink" title="參考連結"></a>參考連結</h2><p><a target="_blank" rel="noopener" href="https://gorails.com/deploy/ubuntu/14.04">Deploy Ruby On Rails on Ubuntu 14.04 Trusty Tahr - GoRails</a></p>
<p><a target="_blank" rel="noopener" href="http://billy3321.blogspot.tw/2013/09/ubuntu-1304-serverruby-on-rails-app.html">雨蒼的終端機: 如何在Ubuntu 13.04 Server上部署Ruby on Rails app</a></p>
<p><a target="_blank" rel="noopener" href="https://ruby-china.org/wiki/install-rails-on-ubuntu-14-04-server">在 Ubuntu 14.04 Server 上安装部署 Ruby on Rails 应用 - Wiki » Ruby China</a></p>
<p><a target="_blank" rel="noopener" href="http://ryanbigg.com/2015/07/deploying-a-rails-application-on-ubuntu-passenger-edition/">Blog of Ryan Bigg - Deploying a Rails application on Ubuntu: Passenger Edition</a></p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2016/05/01/old%20posts/2016-05-01-rails-activerecord-enum-api/" title="Rails 筆記 - 使用 ActiveRecord::Enum 設定狀態"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">Previous: Rails 筆記 - 使用 ActiveRecord::Enum 設定狀態</span></a><a class="button is-default" href="/2016/01/09/old%20posts/2016-01-09-install-go-in-mac-osx-with-homebrew/" title="在 Mac OS X 下使用 brew 安裝 Go"><span class="has-text-weight-semibold">Next: 在 Mac OS X 下使用 brew 安裝 Go</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="LukaHuang/" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com//"><i class="iconfont icon-twitter"></i></a><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/LukaHuang"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><a title="linkedin" target="_blank" rel="noopener nofollow" href="//www.linkedin.com/in/LukaHuang"><i class="iconfont icon-linkedin"></i></a><!-- 脸书--><a title="facebook" target="_blank" rel="noopener nofollow" href="//www.facebook.com//CodeShiba"><i class="iconfont icon-tian7_facebook"></i></a></section><p><span>Copyright ©</span><span> Luka.tw 2021</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo </p></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>